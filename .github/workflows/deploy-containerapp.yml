name: Deploy to Azure Container App

on:
  push:
    branches:
      - main
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

env:
  CONTAINER_REGISTRY_NAME: crskappinsights
  RESOURCE_GROUP: rg-sk-appinsights
  CONTAINER_APP_NAME: etf-agent-app
  IMAGE_NAME: etf-agent
  COSMOS_ACCOUNT_NAME: ${{ secrets.COSMOS_ACCOUNT_NAME || 'cosmosskappinsights' }}

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ”„ Checkout code
      uses: actions/checkout@v4
    
    - name: ðŸ” Azure Login (Service Principal)
      run: |
        # AZURE_CREDENTIALS Secretì—ì„œ ê°’ ì¶”ì¶œ
        CLIENT_ID=$(echo '${{ secrets.AZURE_CREDENTIALS }}' | jq -r '.clientId')
        CLIENT_SECRET=$(echo '${{ secrets.AZURE_CREDENTIALS }}' | jq -r '.clientSecret')
        TENANT_ID=$(echo '${{ secrets.AZURE_CREDENTIALS }}' | jq -r '.tenantId')
        SUBSCRIPTION_ID=$(echo '${{ secrets.AZURE_CREDENTIALS }}' | jq -r '.subscriptionId')
        
        # Azure CLI ë¡œê·¸ì¸
        az login --service-principal \
          --username $CLIENT_ID \
          --password $CLIENT_SECRET \
          --tenant $TENANT_ID
        
        # êµ¬ë… ì„¤ì •
        az account set --subscription $SUBSCRIPTION_ID
        
        echo "âœ… Azure ë¡œê·¸ì¸ ì™„ë£Œ"
    
    - name: ðŸ³ Login to Azure Container Registry
      run: |
        az acr login --name ${{ env.CONTAINER_REGISTRY_NAME }}
    
    - name: ðŸ—ï¸ Build Docker image
      run: |
        docker build \
          --build-arg REACT_APP_VERSION="0.1.0" \
          --build-arg REACT_APP_GIT_COMMIT="${{ github.sha }}" \
          --build-arg REACT_APP_BUILD_TIME="$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
          --build-arg REACT_APP_API_URL="" \
          -t ${{ env.CONTAINER_REGISTRY_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.sha }} \
          -t ${{ env.CONTAINER_REGISTRY_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:latest \
          .
    
    - name: ðŸ“¤ Push Docker image
      run: |
        docker push ${{ env.CONTAINER_REGISTRY_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.sha }}
        docker push ${{ env.CONTAINER_REGISTRY_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:latest
    
    - name: ðŸš€ Deploy to Azure Container App
      run: |
        # Container Appì´ ì¡´ìž¬í•˜ëŠ”ì§€ í™•ì¸
        if az containerapp show --name ${{ env.CONTAINER_APP_NAME }} --resource-group ${{ env.RESOURCE_GROUP }} &>/dev/null; then
          echo "âœ… Container App ì—…ë°ì´íŠ¸ ì¤‘..."
          
          # Secrets ì—…ë°ì´íŠ¸ (ë¹ˆ ê°’ í•„í„°ë§)
          echo "ðŸ” Secrets ì—…ë°ì´íŠ¸ ì¤‘..."
          
          # ë¹ˆ ê°’ì´ ì•„ë‹Œ ì‹œí¬ë¦¿ë§Œ ë°°ì—´ì— ì¶”ê°€
          SECRETS_ARRAY=()
          [[ -n "${{ secrets.APPLICATIONINSIGHTS_CONNECTION_STRING }}" ]] && \
            SECRETS_ARRAY+=("appinsights-connection-string=${{ secrets.APPLICATIONINSIGHTS_CONNECTION_STRING }}")
          [[ -n "${{ secrets.APPLICATIONINSIGHTS_WORKSPACE_ID }}" ]] && \
            SECRETS_ARRAY+=("appinsights-workspace-id=${{ secrets.APPLICATIONINSIGHTS_WORKSPACE_ID }}")
          [[ -n "${{ secrets.COSMOS_ENDPOINT }}" ]] && \
            SECRETS_ARRAY+=("cosmos-endpoint=${{ secrets.COSMOS_ENDPOINT }}")
          [[ -n "${{ secrets.COSMOS_DATABASE_NAME }}" ]] && \
            SECRETS_ARRAY+=("cosmos-database-name=${{ secrets.COSMOS_DATABASE_NAME }}")
          [[ -n "${{ secrets.COSMOS_CONTAINER_NAME }}" ]] && \
            SECRETS_ARRAY+=("cosmos-container-name=${{ secrets.COSMOS_CONTAINER_NAME }}")
          [[ -n "${{ secrets.AZURE_OPENAI_ENDPOINT }}" ]] && \
            SECRETS_ARRAY+=("azure-openai-endpoint=${{ secrets.AZURE_OPENAI_ENDPOINT }}")
          [[ -n "${{ secrets.AZURE_OPENAI_API_KEY }}" ]] && \
            SECRETS_ARRAY+=("azure-openai-api-key=${{ secrets.AZURE_OPENAI_API_KEY }}")
          [[ -n "${{ secrets.AZURE_OPENAI_DEPLOYMENT_NAME }}" ]] && \
            SECRETS_ARRAY+=("azure-openai-deployment-name=${{ secrets.AZURE_OPENAI_DEPLOYMENT_NAME }}")
          [[ -n "${{ secrets.AZURE_OPENAI_API_VERSION }}" ]] && \
            SECRETS_ARRAY+=("azure-openai-api-version=${{ secrets.AZURE_OPENAI_API_VERSION }}")
          [[ -n "${{ secrets.ALPHA_VANTAGE_KEY }}" ]] && \
            SECRETS_ARRAY+=("alpha-vantage-key=${{ secrets.ALPHA_VANTAGE_KEY }}")
          
          # ì‹œí¬ë¦¿ì´ ìžˆëŠ” ê²½ìš°ì—ë§Œ ì„¤ì •
          if [ ${#SECRETS_ARRAY[@]} -gt 0 ]; then
            az containerapp secret set \
              --name ${{ env.CONTAINER_APP_NAME }} \
              --resource-group ${{ env.RESOURCE_GROUP }} \
              --secrets "${SECRETS_ARRAY[@]}" \
              --output none
          else
            echo "âš ï¸  ì„¤ì •í•  ì‹œí¬ë¦¿ì´ ì—†ìŠµë‹ˆë‹¤."
          fi
          
          # ì´ë¯¸ì§€ ë° í™˜ê²½ë³€ìˆ˜ ì—…ë°ì´íŠ¸ (ë¹ˆ ê°’ í•„í„°ë§)
          echo "ðŸ”„ ì´ë¯¸ì§€ ë° í™˜ê²½ë³€ìˆ˜ ì—…ë°ì´íŠ¸ ì¤‘..."
          
          # ë¹ˆ ê°’ì´ ì•„ë‹Œ í™˜ê²½ë³€ìˆ˜ë§Œ ë°°ì—´ì— ì¶”ê°€
          ENV_VARS_ARRAY=()
          # ENVIRONMENTëŠ” í•­ìƒ productionìœ¼ë¡œ ì„¤ì •
          ENV_VARS_ARRAY+=("ENVIRONMENT=production")
          [[ -n "${{ secrets.APPLICATIONINSIGHTS_CONNECTION_STRING }}" ]] && \
            ENV_VARS_ARRAY+=("APPLICATIONINSIGHTS_CONNECTION_STRING=secretref:appinsights-connection-string")
          [[ -n "${{ secrets.APPLICATIONINSIGHTS_WORKSPACE_ID }}" ]] && \
            ENV_VARS_ARRAY+=("APPLICATIONINSIGHTS_WORKSPACE_ID=secretref:appinsights-workspace-id")
          [[ -n "${{ secrets.COSMOS_ENDPOINT }}" ]] && \
            ENV_VARS_ARRAY+=("COSMOS_ENDPOINT=secretref:cosmos-endpoint")
          [[ -n "${{ secrets.COSMOS_DATABASE_NAME }}" ]] && \
            ENV_VARS_ARRAY+=("COSMOS_DATABASE_NAME=secretref:cosmos-database-name")
          [[ -n "${{ secrets.COSMOS_CONTAINER_NAME }}" ]] && \
            ENV_VARS_ARRAY+=("COSMOS_CONTAINER_NAME=secretref:cosmos-container-name")
          [[ -n "${{ secrets.AZURE_OPENAI_ENDPOINT }}" ]] && \
            ENV_VARS_ARRAY+=("AZURE_OPENAI_ENDPOINT=secretref:azure-openai-endpoint")
          [[ -n "${{ secrets.AZURE_OPENAI_API_KEY }}" ]] && \
            ENV_VARS_ARRAY+=("AZURE_OPENAI_API_KEY=secretref:azure-openai-api-key")
          [[ -n "${{ secrets.AZURE_OPENAI_DEPLOYMENT_NAME }}" ]] && \
            ENV_VARS_ARRAY+=("AZURE_OPENAI_DEPLOYMENT_NAME=secretref:azure-openai-deployment-name")
          [[ -n "${{ secrets.AZURE_OPENAI_API_VERSION }}" ]] && \
            ENV_VARS_ARRAY+=("AZURE_OPENAI_API_VERSION=secretref:azure-openai-api-version")
          [[ -n "${{ secrets.ALPHA_VANTAGE_KEY }}" ]] && \
            ENV_VARS_ARRAY+=("ALPHA_VANTAGE_KEY=secretref:alpha-vantage-key")
          
          # í™˜ê²½ë³€ìˆ˜ê°€ ìžˆëŠ” ê²½ìš°ì—ë§Œ ì—…ë°ì´íŠ¸
          if [ ${#ENV_VARS_ARRAY[@]} -gt 0 ]; then
            az containerapp update \
              --name ${{ env.CONTAINER_APP_NAME }} \
              --resource-group ${{ env.RESOURCE_GROUP }} \
              --image ${{ env.CONTAINER_REGISTRY_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.sha }} \
              --set-env-vars "${ENV_VARS_ARRAY[@]}"
          else
            # í™˜ê²½ë³€ìˆ˜ ì—†ì´ ì´ë¯¸ì§€ë§Œ ì—…ë°ì´íŠ¸
            az containerapp update \
              --name ${{ env.CONTAINER_APP_NAME }} \
              --resource-group ${{ env.RESOURCE_GROUP }} \
              --image ${{ env.CONTAINER_REGISTRY_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.sha }}
          fi
          
          echo "âœ… ì—…ë°ì´íŠ¸ ì™„ë£Œ"
        else
          echo "ðŸ“¦ ìƒˆë¡œìš´ Container App ìƒì„± ì¤‘..."
          
          # ACR ìžê²©ì¦ëª… ê°€ì ¸ì˜¤ê¸°
          ACR_USERNAME=$(az acr credential show --name ${{ env.CONTAINER_REGISTRY_NAME }} --query username -o tsv)
          ACR_PASSWORD=$(az acr credential show --name ${{ env.CONTAINER_REGISTRY_NAME }} --query passwords[0].value -o tsv)
          
          # Container App Environment ìƒì„± (ì—†ëŠ” ê²½ìš°)
          if ! az containerapp env show --name etf-agent-env --resource-group ${{ env.RESOURCE_GROUP }} &>/dev/null; then
            az containerapp env create \
              --name etf-agent-env \
              --resource-group ${{ env.RESOURCE_GROUP }} \
              --location koreacentral
          fi
          
          # Container App ìƒì„± (ë¹ˆ ê°’ í•„í„°ë§)
          
          # ë¹ˆ ê°’ì´ ì•„ë‹Œ ì‹œí¬ë¦¿ë§Œ ë°°ì—´ì— ì¶”ê°€
          SECRETS_ARRAY=()
          [[ -n "${{ secrets.APPLICATIONINSIGHTS_CONNECTION_STRING }}" ]] && \
            SECRETS_ARRAY+=("appinsights-connection-string=${{ secrets.APPLICATIONINSIGHTS_CONNECTION_STRING }}")
          [[ -n "${{ secrets.APPLICATIONINSIGHTS_WORKSPACE_ID }}" ]] && \
            SECRETS_ARRAY+=("appinsights-workspace-id=${{ secrets.APPLICATIONINSIGHTS_WORKSPACE_ID }}")
          [[ -n "${{ secrets.COSMOS_ENDPOINT }}" ]] && \
            SECRETS_ARRAY+=("cosmos-endpoint=${{ secrets.COSMOS_ENDPOINT }}")
          [[ -n "${{ secrets.COSMOS_DATABASE_NAME }}" ]] && \
            SECRETS_ARRAY+=("cosmos-database-name=${{ secrets.COSMOS_DATABASE_NAME }}")
          [[ -n "${{ secrets.COSMOS_CONTAINER_NAME }}" ]] && \
            SECRETS_ARRAY+=("cosmos-container-name=${{ secrets.COSMOS_CONTAINER_NAME }}")
          [[ -n "${{ secrets.AZURE_OPENAI_ENDPOINT }}" ]] && \
            SECRETS_ARRAY+=("azure-openai-endpoint=${{ secrets.AZURE_OPENAI_ENDPOINT }}")
          [[ -n "${{ secrets.AZURE_OPENAI_API_KEY }}" ]] && \
            SECRETS_ARRAY+=("azure-openai-api-key=${{ secrets.AZURE_OPENAI_API_KEY }}")
          [[ -n "${{ secrets.AZURE_OPENAI_DEPLOYMENT_NAME }}" ]] && \
            SECRETS_ARRAY+=("azure-openai-deployment-name=${{ secrets.AZURE_OPENAI_DEPLOYMENT_NAME }}")
          [[ -n "${{ secrets.AZURE_OPENAI_API_VERSION }}" ]] && \
            SECRETS_ARRAY+=("azure-openai-api-version=${{ secrets.AZURE_OPENAI_API_VERSION }}")
          [[ -n "${{ secrets.ALPHA_VANTAGE_KEY }}" ]] && \
            SECRETS_ARRAY+=("alpha-vantage-key=${{ secrets.ALPHA_VANTAGE_KEY }}")
          
          # ë¹ˆ ê°’ì´ ì•„ë‹Œ í™˜ê²½ë³€ìˆ˜ë§Œ ë°°ì—´ì— ì¶”ê°€
          ENV_VARS_ARRAY=()
          # ENVIRONMENTëŠ” í•­ìƒ productionìœ¼ë¡œ ì„¤ì •
          ENV_VARS_ARRAY+=("ENVIRONMENT=production")
          [[ -n "${{ secrets.APPLICATIONINSIGHTS_CONNECTION_STRING }}" ]] && \
            ENV_VARS_ARRAY+=("APPLICATIONINSIGHTS_CONNECTION_STRING=secretref:appinsights-connection-string")
          [[ -n "${{ secrets.APPLICATIONINSIGHTS_WORKSPACE_ID }}" ]] && \
            ENV_VARS_ARRAY+=("APPLICATIONINSIGHTS_WORKSPACE_ID=secretref:appinsights-workspace-id")
          [[ -n "${{ secrets.COSMOS_ENDPOINT }}" ]] && \
            ENV_VARS_ARRAY+=("COSMOS_ENDPOINT=secretref:cosmos-endpoint")
          [[ -n "${{ secrets.COSMOS_DATABASE_NAME }}" ]] && \
            ENV_VARS_ARRAY+=("COSMOS_DATABASE_NAME=secretref:cosmos-database-name")
          [[ -n "${{ secrets.COSMOS_CONTAINER_NAME }}" ]] && \
            ENV_VARS_ARRAY+=("COSMOS_CONTAINER_NAME=secretref:cosmos-container-name")
          [[ -n "${{ secrets.AZURE_OPENAI_ENDPOINT }}" ]] && \
            ENV_VARS_ARRAY+=("AZURE_OPENAI_ENDPOINT=secretref:azure-openai-endpoint")
          [[ -n "${{ secrets.AZURE_OPENAI_API_KEY }}" ]] && \
            ENV_VARS_ARRAY+=("AZURE_OPENAI_API_KEY=secretref:azure-openai-api-key")
          [[ -n "${{ secrets.AZURE_OPENAI_DEPLOYMENT_NAME }}" ]] && \
            ENV_VARS_ARRAY+=("AZURE_OPENAI_DEPLOYMENT_NAME=secretref:azure-openai-deployment-name")
          [[ -n "${{ secrets.AZURE_OPENAI_API_VERSION }}" ]] && \
            ENV_VARS_ARRAY+=("AZURE_OPENAI_API_VERSION=secretref:azure-openai-api-version")
          [[ -n "${{ secrets.ALPHA_VANTAGE_KEY }}" ]] && \
            ENV_VARS_ARRAY+=("ALPHA_VANTAGE_KEY=secretref:alpha-vantage-key")
          
          # Container App ìƒì„± (ì¡°ê±´ë¶€ íŒŒë¼ë¯¸í„°)
          if [ ${#SECRETS_ARRAY[@]} -gt 0 ] && [ ${#ENV_VARS_ARRAY[@]} -gt 0 ]; then
            # ì‹œí¬ë¦¿ê³¼ í™˜ê²½ë³€ìˆ˜ ëª¨ë‘ ìžˆëŠ” ê²½ìš°
            az containerapp create \
              --name ${{ env.CONTAINER_APP_NAME }} \
              --resource-group ${{ env.RESOURCE_GROUP }} \
              --environment etf-agent-env \
              --image ${{ env.CONTAINER_REGISTRY_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.sha }} \
              --registry-server ${{ env.CONTAINER_REGISTRY_NAME }}.azurecr.io \
              --registry-username $ACR_USERNAME \
              --registry-password $ACR_PASSWORD \
              --target-port 8000 \
              --ingress external \
              --min-replicas 1 \
              --max-replicas 3 \
              --cpu 0.5 \
              --memory 1Gi \
              --secrets "${SECRETS_ARRAY[@]}" \
              --env-vars "${ENV_VARS_ARRAY[@]}"
          elif [ ${#SECRETS_ARRAY[@]} -gt 0 ]; then
            # ì‹œí¬ë¦¿ë§Œ ìžˆëŠ” ê²½ìš°
            az containerapp create \
              --name ${{ env.CONTAINER_APP_NAME }} \
              --resource-group ${{ env.RESOURCE_GROUP }} \
              --environment etf-agent-env \
              --image ${{ env.CONTAINER_REGISTRY_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.sha }} \
              --registry-server ${{ env.CONTAINER_REGISTRY_NAME }}.azurecr.io \
              --registry-username $ACR_USERNAME \
              --registry-password $ACR_PASSWORD \
              --target-port 8000 \
              --ingress external \
              --min-replicas 1 \
              --max-replicas 3 \
              --cpu 0.5 \
              --memory 1Gi \
              --secrets "${SECRETS_ARRAY[@]}"
          elif [ ${#ENV_VARS_ARRAY[@]} -gt 0 ]; then
            # í™˜ê²½ë³€ìˆ˜ë§Œ ìžˆëŠ” ê²½ìš°
            az containerapp create \
              --name ${{ env.CONTAINER_APP_NAME }} \
              --resource-group ${{ env.RESOURCE_GROUP }} \
              --environment etf-agent-env \
              --image ${{ env.CONTAINER_REGISTRY_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.sha }} \
              --registry-server ${{ env.CONTAINER_REGISTRY_NAME }}.azurecr.io \
              --registry-username $ACR_USERNAME \
              --registry-password $ACR_PASSWORD \
              --target-port 8000 \
              --ingress external \
              --min-replicas 1 \
              --max-replicas 3 \
              --cpu 0.5 \
              --memory 1Gi \
              --env-vars "${ENV_VARS_ARRAY[@]}"
          else
            # ì‹œí¬ë¦¿ê³¼ í™˜ê²½ë³€ìˆ˜ ëª¨ë‘ ì—†ëŠ” ê²½ìš°
            az containerapp create \
              --name ${{ env.CONTAINER_APP_NAME }} \
              --resource-group ${{ env.RESOURCE_GROUP }} \
              --environment etf-agent-env \
              --image ${{ env.CONTAINER_REGISTRY_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.sha }} \
              --registry-server ${{ env.CONTAINER_REGISTRY_NAME }}.azurecr.io \
              --registry-username $ACR_USERNAME \
              --registry-password $ACR_PASSWORD \
              --target-port 8000 \
              --ingress external \
              --min-replicas 1 \
              --max-replicas 3 \
              --cpu 0.5 \
              --memory 1Gi
          fi
        fi
    
    - name: ðŸŒ Configure Cosmos DB Network ACL
      run: |
        echo "=========================================="
        echo "ðŸŒ Cosmos DB ë„¤íŠ¸ì›Œí¬ ACL ì„¤ì • ì¤‘..."
        echo "=========================================="
        
        # Cosmos DBì— ëª¨ë“  IP í—ˆìš© (0.0.0.0) ë° Public Network Access í™œì„±í™”
        echo "ðŸ”“ Cosmos DB ë„¤íŠ¸ì›Œí¬ ì„¤ì • ì¤‘..."
        az cosmosdb update \
          --name ${{ env.COSMOS_ACCOUNT_NAME }} \
          --resource-group ${{ env.RESOURCE_GROUP }} \
          --ip-range-filter "0.0.0.0" \
          --public-network-access enabled \
          --enable-virtual-network false
        
        echo "âœ… Cosmos DB ë„¤íŠ¸ì›Œí¬ ACL ì„¤ì • ì™„ë£Œ!"
        echo ""
        echo "âš ï¸  ì°¸ê³ : Cosmos DBì— ëª¨ë“  IP(0.0.0.0)ì˜ ì ‘ê·¼ì´ í—ˆìš©ë˜ì—ˆìŠµë‹ˆë‹¤."
        echo "   ë³´ì•ˆì„ ìœ„í•´ Azure AD ì¸ì¦ì„ ì‚¬ìš©í•˜ê³  ìžˆìŠµë‹ˆë‹¤."
    
    - name: ðŸŽ‰ Get App URL
      run: |
        APP_URL=$(az containerapp show \
          --name ${{ env.CONTAINER_APP_NAME }} \
          --resource-group ${{ env.RESOURCE_GROUP }} \
          --query properties.configuration.ingress.fqdn -o tsv)
        
        echo "=========================================="
        echo "ðŸš€ ë°°í¬ ì™„ë£Œ!"
        echo "=========================================="
        echo "ðŸŒ Frontend URL: https://$APP_URL"
        echo "ðŸ”§ Backend API URL: https://$APP_URL/api"
        echo "ðŸ’š Health Check: https://$APP_URL/health"
        echo "ðŸ“š API Docs: https://$APP_URL/docs"
        echo "=========================================="
        
        # GitHub Step Summaryì— ì¶”ê°€
        echo "## ðŸŽ‰ ë°°í¬ ì„±ê³µ!" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸŒ ì ‘ì† URL" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "| ì„œë¹„ìŠ¤ | URL |" >> $GITHUB_STEP_SUMMARY
        echo "|--------|-----|" >> $GITHUB_STEP_SUMMARY
        echo "| **Frontend** | https://$APP_URL |" >> $GITHUB_STEP_SUMMARY
        echo "| **Backend API** | https://$APP_URL/api |" >> $GITHUB_STEP_SUMMARY
        echo "| **Health Check** | https://$APP_URL/health |" >> $GITHUB_STEP_SUMMARY
        echo "| **API Docs** | https://$APP_URL/docs |" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“¦ ë°°í¬ ì •ë³´" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ·ï¸ **Image Tag**: \`${{ github.sha }}\`" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ“… **ë°°í¬ ì‹œê°„**: $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY
